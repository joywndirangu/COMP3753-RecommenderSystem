<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sign In</title>
        <link rel="stylesheet" href="sign.css">
    </head>
    <signinbody>
        <header>
                <img src="MiniHeader.png" alt="AcadiaPG">
        </header>
       
        <div class="navbar">
            <p></p>
        </div>

        <main>
            <h1>WELCOME!</h1>
            <div class="container1">
                <div class="container2">
                    <form id="signin">
                        <div class="container">
                          <h1>Sign In</h1>
                          <p>Please fill in this form to sign into your account.</p>
                          <hr>
                      
                          <label for="email"><b>Email</b></label>
                          <input type="text" placeholder="Enter Email" name="email" id="email" required>
                      
                          <label for="psw"><b>Password</b></label>
                          <input type="password" placeholder="Enter Password" name="psw" id="psw" required>
                          <hr>
                      
                          <button type="submit" class="registerbtn">Sign In</button>
                        </div>

                        <div class="container signin">
                            <p>Don't have an account with us? <a href="#" id="registerlink">Register</a>.</p>
                        </div>
                    </form>
                    <form id="register" class="register">
                        <div class="container">
                            <h1>Register</h1>
                            <p>Please fill in this form to create an account.</p>
                            <hr>
                        
                            <label for="email"><b>Email</b></label>
                            <input type="text" placeholder="Enter Email" name="email" id="email" required>
                        
                            <label for="psw"><b>Password</b></label>
                            <input type="password" placeholder="Enter Password" name="psw" id="psw" required>
                        
                            <label for="psw-repeat"><b>Repeat Password</b></label>
                            <input type="password" placeholder="Repeat Password" name="psw-repeat" id="psw-repeat" required>
                            <hr>
                            <p>By creating an account you agree to our <a href="#">Terms & Privacy</a>.</p>
                        
                            <button type="submit" class="registerbtn">Register</button>
                          </div>
                          
                          <div class="container signin">
                            <p>Already have an account? <a href="#" id="signinlink">Sign in</a>.</p>
                          </div>
                    </form>
                </div>
            </div>
        </main>
        <script>
            function toggleForms(showForm, hideForm) {
                document.getElementById(showForm).style.display = 'block';
                document.getElementById(hideForm).style.display = 'none';
            }

            document.getElementById('signinlink').addEventListener('click', function(event) {
                event.preventDefault();
                toggleForms('signin', 'register');
            });
        
            document.getElementById('registerlink').addEventListener('click', function(event) {
                event.preventDefault();
                toggleForms('register', 'signin');
            });

            async function req(type, act, data) {

                try {

                    const response = await fetch('https://localhost:4443/', {

                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },

                        credentials: 'include',

                        body: JSON.stringify({
                            'type': type,
                            'act': act,
                            'data': data,
                        }),
                    });

                    if (!response.ok) {
                        throw new Error('network response was not ok');
                    }

                    const contentType = response.headers.get('Content-Type');

                    if (contentType && contentType.includes('application/json')) {
                        const json = await response.json();
                        console.log('Server responded with JSON:', json);
                        return json;
                    } else {
                        const text = await response.text();
                        console.log('Server responded with plain text:', text);
                        return text;
                    }
                } 

                catch (error) {
                    console.error('There was a problem with your fetch operation:', error);
                }
            }

            function sign_in(event) {


                event.preventDefault();

                let response = req('signin', null, [
                    document.getElementbyId('email').value,
                    document.getElementsById('psw').value
                ]);

                if (response == 'success - cookie set successfully') {
                    window.location = 'https://localhost:4443/patientDB.html'
                } else {
                    console.log(response);
                }
            }

            document.getElementById('signin').addEventListener('submit', sign_in)
        </script>
    </signinbody>
</html>